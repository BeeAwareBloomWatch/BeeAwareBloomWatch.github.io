<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeeAware - Map with Timeline</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        /* --- Styles remain the same --- */
        body { --nav-height: 60px; padding-top: var(--nav-height); background-color: rgb(241, 228, 189);}
        .nav {width: 100%; height: var(--nav-height); position: fixed; top: 0; left: 0; background-color: rgba(233, 171, 23, 0.8); transition: transform 0.2s ease-in-out; z-index: 1200; border-bottom-left-radius: 30px;  border-bottom-right-radius: 30px;  overflow: hidden;}
        .nav--hidden { transform: translateY(calc(-1 * var(--nav-height))); }
        .nav__link { color: white; text-decoration: none; margin: 0 1em; font-weight: bold; }
        #map {
            width: 100%;
            height: 100%;
            min-height: 500px;
        }
        .timeline-body-wrapper {
             font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
             display: flex;
             flex-direction: column;
             align-items: center;
             padding: 20px 0;
        }
        .timeline-container {
             max-width: 1200px;
             width: 100%;
             background: white;
             border-radius: 20px;
             box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
             overflow: hidden;
             margin-top: 2rem;
        }
        .timeline-header {
             background-color: #E9AB17;
             color: white;
             padding: 30px;
             text-align: center;
        }
        .timeline-header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .timeline-header p { font-size: 1.1em; opacity: 0.9; }
        .image-display { position: relative; width: 100%; height: 500px; background: #f0f0f0; overflow: hidden; }
        .image-display img { width: 100%; height: 100%; object-fit: cover; transition: opacity 0.3s ease; }
        .image-overlay { position: absolute; top: 20px; left: 20px; background: rgba(0, 0, 0, 0.7); color: white; padding: 15px 25px; border-radius: 10px; font-size: 1.5em; font-weight: bold; }
        .timeline-controls { padding: 40px; background: #f8f9fa; }
        .timeline-label { text-align: center; font-size: 1.3em; color: #333; margin-bottom: 30px; font-weight: 600; }
        .slider-wrapper { position: relative; width: 100%; margin-bottom: 40px; }
        .slider { -webkit-appearance: none; appearance: none; width: 100%; height: 8px; border-radius: 5px; background: #d3d3d3; outline: none; cursor: pointer; }
        .slider::-webkit-slider-thumb {
             -webkit-appearance: none;
             appearance: none;
             width: 25px;
             height: 25px;
             border-radius: 50%;
             background: #E9AB17;
             cursor: pointer;
             box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
             transition: all 0.2s ease;
        }
        .slider::-webkit-slider-thumb:hover { transform: scale(1.2); }
        .slider::-moz-range-thumb {
             width: 25px;
             height: 25px;
             border-radius: 50%;
             background: #E9AB17;
             cursor: pointer;
             border: none;
             box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        }
        .months-grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 10px; margin-top: 20px; }
        .month-marker { text-align: center; font-size: 0.9em; color: #666; font-weight: 500; padding: 8px 5px; border-radius: 5px; transition: all 0.2s ease; cursor: pointer; }
        .month-marker:hover { background: #fef3c7; }
        .month-marker.active { background: #E9AB17; color: white; font-weight: 700; }
        .placeholder-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #999; font-size: 1.2em; }
    </style>
</head>
<body class="">
    <nav class="nav">
        </nav>

    <div id="map-section">
        <nav class="nav">
        <div class="container mx-auto flex justify-between items-center p-4">
            <div class="font-bold text-xl text-white flex items-center gap-1">
                <span class="striped">BeeAware</span>
                <img src="beeLogo.png" alt="Bee logo" class="h-10 w-10">
            </div>
            <div>
                <a href="index.html" class="nav__link">Home</a>
                <a href="map.html" class="nav__link">Map</a>
                <a href="2026page.html" class="nav__link">2026 Predictions</a>
                <a href="data.html" class="nav__link">Historical Data</a>
                <a href="about.html" class="nav__link">About Us</a>
            </div>
        </div>
    </nav>
        <div class="p-4 md:p-8">
            <h2 class="text-3xl font-bold mb-4">Farmer's Bloom Map</h2>
            <div class="flex flex-col md:flex-row gap-8 h-[85vh] bg-white rounded-lg shadow-lg p-4">
                <aside class="w-full md:w-1/4 border-r pr-4 flex flex-col">
                    <h3 class="text-xl font-semibold mb-4">Controls</h3>
                    <p class="text-gray-600 mb-4">Find your location or calculate travel time.</p> <div class="space-y-3">
                        <button id="locate-btn" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition">üìç Find My Location</button>
                        <button id="cali-btn" class="w-full bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition">‚û°Ô∏è Center on California</button>
                        <button id="distance-btn" class="w-full bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 transition">üöó Calculate Distance to Pins</button>
                    </div>
                    <div id="distance-output" class="mt-auto pt-4 border-t text-sm text-gray-700"> Click "Calculate Distance" to see travel times.
                    </div>
                </aside>
                <div id="map" class="w-full h-full rounded-md"></div>
            </div>

            <div class="timeline-body-wrapper">
                <div class="timeline-container">
                    <div class="timeline-header">
                        <h1>2023 California Superbloom Timeline</h1>
                        <p>Drag the slider to explore monthly satellite imagery</p>
                    </div>
            
                    <div class="image-display" id="imageDisplay">
                        <div class="placeholder-text">Your satellite images will appear here.</div>
                        <img id="satelliteImage" src="" alt="Satellite imagery" style="display: none;">
                        <div class="image-overlay" id="monthLabel"></div>
                    </div>
            
                    <div class="timeline-controls">
                        <div class="timeline-label">Select Month</div>
                        <div class="slider-wrapper">
                            <input type="range" min="0" max="11" value="0" class="slider" id="monthSlider">
                        </div>
                        <div class="months-grid" id="monthsGrid">
                           </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        // --- NAVBAR HIDING LOGIC ---
        const nav = document.querySelector(".nav");
        let lastScrollY = window.scrollY;
        window.addEventListener("scroll", () => { /* ... navbar logic ... */ });

        // --- MAP INITIALIZATION ---
        const corner1 = L.latLng(36, -122);
        const corner2 = L.latLng(33, -117);
        const bounds = L.latLngBounds(corner1, corner2);
        const map = L.map('map', { center: [34.93855, -119.0673], zoom: 8.5, maxBounds: bounds, minZoom: 8.5});
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap contributors &copy; CARTO'
        }).addTo(map);

        const pins = { "Antelope Valley": [34.7386, -118.3765], "Carrizo Plain": [35.1385, -119.7581] };
        L.marker(pins["Antelope Valley"]).addTo(map).bindPopup("<b>Antelope Valley</b>");
        L.marker(pins["Carrizo Plain"]).addTo(map).bindPopup("<b>Carrizo Plain</b>");

        // --- Time Slider and Overlay Logic Removed ---

        // --- BUTTON AND DISTANCE FINDER LOGIC ---
        const locateBtn = document.getElementById('locate-btn');
        const caliBtn = document.getElementById('cali-btn');
        const distanceBtn = document.getElementById('distance-btn');

        locateBtn.addEventListener('click', () => {
            if ('geolocation' in navigator) {
                navigator.geolocation.getCurrentPosition(pos => {
                    const userCoords = [pos.coords.latitude, pos.coords.longitude];
                    map.setView(userCoords, 13);
                    L.circleMarker(userCoords, { radius: 8, color: '#007bff', fillColor: '#007bff', fillOpacity: 0.8 }).addTo(map).bindPopup("<b>You are here!</b>").openPopup();
                    getDistanceMatrix(userCoords.join(',')); 
                });
            }
        });
        
        caliBtn.addEventListener('click', () => map.setView([34.93855, -119.0673], 8.5));

        distanceBtn.addEventListener('click', () => {
            const userLocation = prompt("Please enter your starting location (e.g. 'Los Angeles, CA'):");
            if (userLocation) {
                getDistanceMatrix(userLocation);
            }
        });

        async function getDistanceMatrix(origin) {
            const outputDiv = document.getElementById('distance-output');
            outputDiv.innerHTML = `<p>Calculating distances...</p>`;
            const apiKey = "AIzaSyBaHFOVNTAzscX8atqhC5im0zZVM7yjjeY"; // IMPORTANT: Replace with your actual key

            const destination1 = pins["Antelope Valley"].join(',');
            const destination2 = pins["Carrizo Plain"].join(',');
            const destinations = `${destination1}|${destination2}`;

            const url = `https://maps.googleapis.com/maps/api/distancematrix/json?origins=${encodeURIComponent(origin)}&destinations=${encodeURIComponent(destinations)}&units=imperial&key=${apiKey}`;
            const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;

            try {
                const response = await fetch(proxyUrl);
                const data = await response.json();
                const result = JSON.parse(data.contents);

                if (result.status !== 'OK' || !result.rows[0]) {
                    throw new Error('API response was not OK');
                }
                const elements = result.rows[0].elements;
                let outputHTML = "";
                if (elements[0].status === "OK") {
                    outputHTML += `<p><b>To Antelope Valley:</b><br>${elements[0].distance.text} ‚Äî ${elements[0].duration.text}</p>`;
                } else {
                    outputHTML += `<p><b>To Antelope Valley:</b><br>Could not calculate route.</p>`;
                }
                if (elements[1].status === "OK") {
                    outputHTML += `<p class="mt-2"><b>To Carrizo Plain:</b><br>${elements[1].distance.text} ‚Äî ${elements[1].duration.text}</p>`;
                } else {
                    outputHTML += `<p class="mt-2"><b>To Carrizo Plain:</b><br>Could not calculate route.</p>`;
                }
                outputDiv.innerHTML = outputHTML;
            } catch (error) {
                outputDiv.innerHTML = `<p class="text-red-500">Error fetching data. Please check the console and your API key.</p>`;
                console.error("Distance Matrix Error:", error);
            }
        }

        // --- TIMELINE SLIDER SCRIPT ---
        const monthImages = {
             0: 'img/january.png', 1: 'img/february.png', 2: 'img/march.png',
             3: 'img/april.png', 4: 'img/may.png', 5: 'img/june.png',
             6: 'img/july.png', 7: 'img/august.png', 8: 'img/september.png',
             9: 'img/october.png', 10: 'img/november.png', 11: 'img/december.png'
        };
        const monthNames = [ 'January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December' ];
        const monthAbbrs = [ 'JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC' ];

        const monthSliderEl = document.getElementById('monthSlider');
        const satelliteImage = document.getElementById('satelliteImage');
        const monthLabel = document.getElementById('monthLabel');
        const monthsGrid = document.getElementById('monthsGrid');

        monthAbbrs.forEach((abbr, index) => {
            const marker = document.createElement('div');
            marker.classList.add('month-marker');
            marker.textContent = abbr;
            marker.dataset.month = index;
            monthsGrid.appendChild(marker);
        });
        const monthMarkers = document.querySelectorAll('.month-marker');

        function updateDisplay(monthIndex) {
             const imagePath = monthImages[monthIndex];
             if (imagePath) {
                 satelliteImage.src = imagePath;
                 satelliteImage.style.display = 'block';
                 document.querySelector('.placeholder-text').style.display = 'none';
             }
             monthLabel.textContent = monthNames[monthIndex];
             monthMarkers.forEach(marker => {
                 marker.classList.remove('active');
                 if (parseInt(marker.dataset.month) === monthIndex) {
                     marker.classList.add('active');
                 }
             });
        }
        monthSliderEl.addEventListener('input', (e) => { updateDisplay(parseInt(e.target.value)); });
        monthMarkers.forEach(marker => {
             marker.addEventListener('click', () => {
                 const monthIndex = parseInt(marker.dataset.month);
                 monthSliderEl.value = monthIndex;
                 updateDisplay(monthIndex);
             });
        });
        updateDisplay(0);
    });
    </script>
</body>
</html>
